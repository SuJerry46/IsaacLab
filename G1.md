# Unitree G1 Robot in IsaacLab

本文檔詳細介紹了 Unitree G1 人形機器人在 IsaacLab 中的所有任務、功能和示例。

## 目錄
- [概述](#概述)
- [G1 機器人任務](#g1-機器人任務)
- [配置文件](#配置文件)
- [示例和演示](#示例和演示)
- [運行命令](#運行命令)
- [遙操作支持](#遙操作支持)
- [文件位置](#文件位置)

## 概述

Unitree G1 是一款先進的人形機器人，在 IsaacLab 中支持：
- **運動控制**: 平坦和崎嶇地形上的速度控制
- **操作任務**: 帶有靈巧手的抓取和放置
- **運動操作**: 結合運動和操作的複合任務
- **遙操作**: Apple Vision Pro 支持的數據收集
- **模仿學習**: 策略訓練工作流程

## G1 機器人任務

### 1. 運動任務 (Locomotion Tasks)

#### 1.1 平坦地形運動
- **任務ID**: `Isaac-Velocity-Flat-G1-v0`
- **描述**: G1 機器人在平坦地面上的速度控制運動
- **配置文件**: `source/isaaclab_tasks/isaaclab_tasks/manager_based/locomotion/velocity/config/g1/flat_env_cfg.py`

#### 1.2 崎嶇地形運動
- **任務ID**: `Isaac-Velocity-Rough-G1-v0`
- **描述**: G1 機器人在崎嶇地形上的運動控制
- **配置文件**: `source/isaaclab_tasks/isaaclab_tasks/manager_based/locomotion/velocity/config/g1/rough_env_cfg.py`

#### 1.3 遊玩版本 (Play Versions)
- **平坦地形遊玩版**: `Isaac-Velocity-Flat-G1-Play-v0`
- **崎嶇地形遊玩版**: `Isaac-Velocity-Rough-G1-Play-v0`
- **特點**: 較小的環境設置，適合演示和測試

### 2. 操作任務 (Manipulation Tasks)

#### 2.1 Inspire 手抓取放置
- **任務ID**: `Isaac-PickPlace-G1-InspireFTP-Abs-v0`
- **描述**: 使用 Inspire 五指靈巧手的抓取和放置任務
- **配置文件**: `source/isaaclab_tasks/isaaclab_tasks/manager_based/manipulation/pick_place/pickplace_unitree_g1_inspire_hand_env_cfg.py`

### 3. 運動操作任務 (Locomanipulation Tasks)

#### 3.1 全身運動操作
- **任務ID**: `Isaac-PickPlace-Locomanipulation-G1-Abs-v0`
- **描述**: 結合運動和操作的複合任務，機器人需要移動到目標位置並執行抓取放置
- **配置文件**: `source/isaaclab_tasks/isaaclab_tasks/manager_based/locomanipulation/pick_place/locomanipulation_g1_env_cfg.py`

#### 3.2 固定底座上身逆運動學
- **任務ID**: `Isaac-PickPlace-FixedBaseUpperBodyIK-G1-Abs-v0`
- **描述**: 固定底座，僅控制上身進行操作任務
- **配置文件**: `source/isaaclab_tasks/isaaclab_tasks/manager_based/locomanipulation/pick_place/fixed_base_upper_body_ik_g1_env_cfg.py`

## 配置文件

### 機器人資產配置
- **完整配置**: `G1_CFG` - 完整的 G1 機器人配置
- **最小配置**: `G1_MINIMAL_CFG` - 性能優化的最小配置
- **位置**: `source/isaaclab_assets/`

### 手部配置
- **Inspire 手**: 五指靈巧手配置
- **TriHand**: 高級靈巧操作配置
- **表面抓取器**: 吸盤式抓取器支持

### 獎勵配置
位置: `source/isaaclab_tasks/isaaclab_tasks/manager_based/locomotion/velocity/config/g1/rough_env_cfg.py`

主要獎勵項目：
- `termination_penalty`: 終止懲罰 (-200.0)
- `track_lin_vel_xy_exp`: 線性速度跟踪 (1.0)
- `track_ang_vel_z_exp`: 角速度跟踪 (2.0)
- `feet_air_time`: 腳部滯空時間 (0.25)
- `feet_slide`: 腳部滑動懲罰 (-0.1)
- `joint_deviation_*`: 關節偏差懲罰

## 示例和演示

### 1. 基礎機器人演示
**文件**: `scripts/demos/bipeds.py`
```python
from isaaclab_assets import G1_CFG
g1 = Articulation(G1_CFG.replace(prim_path="/World/G1"))
robots = [cassie, h1, g1]  # 與其他雙足機器人一起展示
```

**運行命令**:
```bash
./isaaclab.sh -p scripts/demos/bipeds.py
```

### 2. 性能基準測試
**文件**: `scripts/benchmarks/benchmark_load_robot.py`
```bash
./isaaclab.sh -p scripts/benchmarks/benchmark_load_robot.py --num_envs 2048 --robot g1 --headless
```

### 3. 抓取放置演示
**文件**: `scripts/demos/pick_and_place.py`
- 交互式演示，可使用鼠標和鍵盤控制
- 目標：抓取紫色立方體並放置到紅色球體上

控制說明：
- 按住 `A` 鍵：抓取器跟踪立方體位置
- 按住 `D` 鍵：抓取器跟踪目標位置
- `W`/`S` 鍵：龍門架上升/下降
- `Q`/`E` 鍵：打開/關閉抓取器

## 運行命令

### 1. 運動任務訓練

#### 平坦地形訓練
```bash
# RSL-RL 訓練
./isaaclab.sh -p scripts/reinforcement_learning/rsl_rl/train.py \
    --task Isaac-Velocity-Flat-G1-v0 \
    --num_envs 4096

# 播放已訓練策略
./isaaclab.sh -p scripts/reinforcement_learning/rsl_rl/play.py \
    --task Isaac-Velocity-Flat-G1-Play-v0 \
    --checkpoint /path/to/checkpoint.pth
```

#### 崎嶇地形訓練
```bash
# 訓練
./isaaclab.sh -p scripts/reinforcement_learning/rsl_rl/train.py \
    --task Isaac-Velocity-Rough-G1-v0 \
    --num_envs 4096

# 播放
./isaaclab.sh -p scripts/reinforcement_learning/rsl_rl/play.py \
    --task Isaac-Velocity-Rough-G1-Play-v0 \
    --checkpoint /path/to/checkpoint.pth
```

### 2. 操作任務訓練

#### Inspire 手抓取放置
```bash
# 模仿學習訓練
./isaaclab.sh -p scripts/reinforcement_learning/robomimic/train.py \
    --task Isaac-PickPlace-G1-InspireFTP-Abs-v0 \
    --dataset /path/to/dataset.hdf5

# 策略播放
./isaaclab.sh -p scripts/reinforcement_learning/robomimic/play.py \
    --task Isaac-PickPlace-G1-InspireFTP-Abs-v0 \
    --checkpoint /path/to/checkpoint.pth
```

### 3. 運動操作任務

#### 全身運動操作訓練
```bash
# 訓練
./isaaclab.sh -p scripts/reinforcement_learning/robomimic/train.py \
    --task Isaac-PickPlace-Locomanipulation-G1-Abs-v0 \
    --dataset /path/to/locomanipulation_dataset.hdf5

# 播放
./isaaclab.sh -p scripts/reinforcement_learning/robomimic/play.py \
    --task Isaac-PickPlace-Locomanipulation-G1-Abs-v0 \
    --checkpoint /path/to/checkpoint.pth
```

### 4. 環境列表和測試
```bash
# 列出所有 G1 相關環境
./isaaclab.sh -p scripts/environments/list_envs.py | grep G1

# 測試環境
./isaaclab.sh -p scripts/environments/zero_agent.py \
    --task Isaac-Velocity-Flat-G1-v0 \
    --num_envs 32
```

## 遙操作支持

### 1. XR 設備集成
G1 機器人支持通過 Apple Vision Pro 進行遙操作數據收集：

```bash
# 遙操作控制
./isaaclab.sh -p scripts/environments/teleoperation/teleop_se3_agent.py \
    --task Isaac-PickPlace-G1-InspireFTP-Abs-v0 \
    --teleop_device handtracking \
    --enable_pinocchio
```

### 2. 數據收集
```bash
# 記錄演示數據
./isaaclab.sh -p scripts/tools/record_demos.py \
    --device cpu \
    --task Isaac-PickPlace-Locomanipulation-G1-Abs-v0 \
    --teleop_device handtracking \
    --dataset_file ./datasets/g1_locomanip_dataset.hdf5 \
    --num_demos 50 \
    --enable_pinocchio
```

### 3. 數據重放
```bash
# 重放記錄的演示
./isaaclab.sh -p scripts/tools/replay_demos.py \
    --device cpu \
    --task Isaac-PickPlace-G1-InspireFTP-Abs-v0 \
    --dataset_file ./datasets/g1_dataset.hdf5 \
    --enable_pinocchio
```

### 4. 重定向配置
- **上身重定向**: `G1TriHandUpperBodyRetargeterCfg`
- **下身站立**: `g1_lower_body_standing.py`
- **手部重定向**: Inspire 和 TriHand 支持

## 物理傳輸支持

G1 機器人支持 Newton 和 PhysX 物理引擎之間的策略傳輸：

### Newton 到 PhysX 傳輸
```bash
./isaaclab.sh -p scripts/sim2sim_transfer/newton_to_physx_transfer.py \
    --task=Isaac-Velocity-Flat-G1-v0 \
    --checkpoint=/path/to/newton_policy.pth \
    --policy_transfer_file scripts/sim2sim_transfer/config/newton_to_physx_g1.yaml
```

### PhysX 到 Newton 傳輸
```bash
./isaaclab.sh -p scripts/sim2sim_transfer/physx_to_newton_transfer.py \
    --task=Isaac-Velocity-Flat-G1-v0 \
    --checkpoint=/path/to/physx_policy.pth \
    --policy_transfer_file scripts/sim2sim_transfer/config/physx_to_newton_g1.yaml
```

## 文件位置

### 核心任務配置
```
source/isaaclab_tasks/isaaclab_tasks/manager_based/
├── locomotion/velocity/config/g1/
│   ├── __init__.py                 # 環境註冊
│   ├── flat_env_cfg.py            # 平坦地形配置
│   ├── rough_env_cfg.py           # 崎嶇地形配置
│   └── agents/                    # RL 代理配置
├── manipulation/pick_place/
│   └── pickplace_unitree_g1_inspire_hand_env_cfg.py
└── locomanipulation/pick_place/
    ├── locomanipulation_g1_env_cfg.py
    └── fixed_base_upper_body_ik_g1_env_cfg.py
```

### 機器人資產
```
source/isaaclab_assets/isaaclab_assets/robots/
└── unitree/
    ├── g1.py                      # G1 機器人配置
    └── g1_minimal.py              # 最小化配置
```

### 遙操作配置
```
source/isaaclab/isaaclab/devices/openxr/retargeters/humanoid/unitree/
├── g1_lower_body_standing.py
├── inspire/
│   ├── g1_upper_body_retargeter.py
│   └── g1_dex_retargeting_utils.py
└── trihand/
    ├── g1_upper_body_retargeter.py
    ├── g1_dex_retargeting_utils.py
    └── data/configs/dex-retargeting/
```

### 演示腳本
```
scripts/
├── demos/
│   ├── bipeds.py                  # 雙足機器人演示
│   └── pick_and_place.py          # 抓取放置演示
├── benchmarks/
│   └── benchmark_load_robot.py    # 性能基準測試
└── environments/teleoperation/
    └── teleop_se3_agent.py        # 遙操作代理
```

### 配置文件
```
scripts/sim2sim_transfer/config/
├── newton_to_physx_g1.yaml
└── physx_to_newton_g1.yaml
```

## 技術特性

### 硬件規格支持
- **關節**: 23-35 個自由度（取決於配置）
- **手部**: Inspire 五指靈巧手或 TriHand 靈巧手
- **感測器**: IMU、關節位置/速度、接觸力傳感器
- **視覺**: 攝像頭支持（可選）

### 控制方式
- **位置控制**: 關節位置目標控制
- **速度控制**: 基於速度的運動控制
- **逆運動學**: 上身操作的 IK 控制
- **混合控制**: 運動操作的組合控制

### 學習算法支持
- **強化學習**: RSL-RL、SKRL、RL-Games、Stable Baselines
- **模仿學習**: Robomimic、BC (行為克隆)
- **多智能體**: 支持多智能體強化學習

## 故障排除

### 常見問題
1. **記憶體不足**: 減少 `num_envs` 參數
2. **GPU 記憶體不足**: 使用 `--headless` 模式或降低渲染質量
3. **關節限制**: 檢查關節位置限制設置
4. **碰撞檢測**: 調整碰撞網格設置

### 性能優化
- 使用 `G1_MINIMAL_CFG` 提高性能
- 啟用 GPU 管道加速
- 調整物理步長設置
- 使用適當的環境數量

## 參考資源

- [IsaacLab 官方文檔](https://isaac-sim.github.io/IsaacLab/)
- [Unitree G1 官方規格](https://www.unitree.com/)
- [強化學習教程](https://isaac-sim.github.io/IsaacLab/main/source/overview/reinforcement-learning/)
- [遙操作指南](https://isaac-sim.github.io/IsaacLab/main/source/how-to/cloudxr_teleoperation.html)

---

**更新日期**: 2025年10月20日  
**版本**: IsaacLab 2.3.0  
**支持的 Isaac Sim 版本**: 4.5 / 5.0 / 5.1